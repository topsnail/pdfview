# PDF智库 - PDF文件管理系统

一个基于Cloudflare Pages和Workers的PDF文件管理系统，支持文件上传、标签管理、搜索和在线预览等功能。

## 📋 项目简介

PDF智库是一个轻量级但功能强大的PDF文件管理系统，专为个人和小团队设计。它利用Cloudflare的全球边缘网络，提供快速、安全、可靠的PDF文件管理解决方案。

### 🌟 核心功能

- **用户认证**：基于密码的认证系统，保护您的文件安全
- **PDF文件管理**：支持PDF文件的上传、查看、删除和恢复
- **标签系统**：为文件添加标签，方便分类和搜索
- **智能搜索**：支持按文件名和标签搜索
- **回收站**：误删文件可在回收站中恢复
- **在线预览**：使用PDF.js实现高质量的PDF在线预览
- **响应式设计**：适配桌面和移动设备

### 🎯 应用场景

- **个人文档管理**：整理和管理个人PDF文档
- **团队文件共享**：小团队内部PDF文件的集中管理
- **知识库构建**：创建和管理PDF格式的知识库
- **文档协作**：团队成员之间的PDF文档协作

## 🛠️ 技术栈

| 类别 | 技术/服务 | 用途 |
|------|-----------|------|
| 前端 | HTML5 + CSS3 + JavaScript | 页面结构和交互 |
| 前端库 | PDF.js | PDF文件渲染 |
| 前端库 | Font Awesome | 图标库 |
| 后端 | Cloudflare Workers | 后端API和逻辑 |
| 存储 | Cloudflare R2 | PDF文件存储 |
| 存储 | Cloudflare KV | 元数据和配置存储 |
| 部署 | Cloudflare Pages | 静态网站托管 |

## 📁 项目结构

```
pdfview-main/
├── index.html          # 主页面，PDF文件管理界面
├── viewer.html         # PDF文件预览页面
├── script.js           # 前端业务逻辑
├── style.css           # 页面样式
├── _worker.js          # Cloudflare Workers后端逻辑
├── local-test.html     # 本地测试说明
├── test.html           # 美化效果预览
└── README.md           # 项目说明文档
```

### 核心文件说明

| 文件 | 功能 |
|------|------|
| `index.html` | 主页面，包含文件上传、管理和搜索功能 |
| `viewer.html` | PDF文件预览页面，使用PDF.js渲染PDF |
| `script.js` | 前端业务逻辑，处理用户交互和API调用 |
| `style.css` | 页面样式，提供美观的用户界面 |
| `_worker.js` | Cloudflare Workers后端逻辑，处理API请求和存储操作 |

## 🔧 本地开发

### 环境要求

- 现代浏览器（Chrome、Firefox、Safari、Edge）
- 互联网连接（用于加载CDN资源）

### 本地测试方法

1. **直接打开**：在浏览器中直接打开 `index.html` 文件
2. **本地服务器**：使用以下方法启动本地服务器

   ```bash
   # 使用Python 3
   python -m http.server 8000
   
   # 使用Node.js（需要安装http-server）
   npx http-server -p 8000
   
   # 使用PHP
   php -S localhost:8000
   ```

3. **访问地址**：打开浏览器访问 `http://localhost:8000`

### 开发流程

1. 修改前端文件（`index.html`、`script.js`、`style.css`）
2. 在浏览器中刷新页面查看更改
3. 测试功能是否正常
4. 部署到Cloudflare Pages

## ☁️ Cloudflare Pages部署

### 部署前准备

1. **Cloudflare账号**：注册并登录Cloudflare账号
2. **GitHub/GitLab账号**：用于代码托管
3. **项目代码**：将项目代码推送到GitHub或GitLab仓库

### 详细部署步骤

#### 1. 创建Cloudflare Pages项目

1. 登录Cloudflare控制台
2. 导航到 **Pages** 部分
3. 点击 **创建项目** 按钮
4. 选择 **连接到Git**
5. 选择包含项目代码的仓库
6. 点击 **开始设置**

#### 2. 配置部署设置

1. **项目名称**：输入项目名称
2. **生产分支**：选择主分支（如 `main` 或 `master`）
3. **构建命令**：留空（静态网站不需要构建）
4. **构建输出目录**：留空（使用根目录）
5. **环境变量**：暂时不设置，后续在Workers中配置
6. 点击 **保存并部署**

#### 3. 部署完成

部署完成后，Cloudflare Pages会为您分配一个默认域名，格式为 `[项目名称].pages.dev`。

### 环境变量设置

#### 1. Cloudflare Workers设置

1. 在Cloudflare控制台中，导航到 **Workers & Pages** > **Workers**
2. 找到与Pages项目关联的Worker
3. 点击 **设置** 标签页
4. 点击 **变量** 部分的 **编辑变量**

#### 2. 配置环境变量

| 变量名 | 值 | 说明 |
|--------|-----|------|
| `ACCESS_PASSWORD` | 您设置的管理密码 | 用户登录密码 |
| `PDF_FILES` | KV命名空间绑定 | 绑定到创建的KV命名空间 |
| `MY_BUCKET` | R2存储桶绑定 | 绑定到创建的R2存储桶 |

#### 3. R2存储桶配置

1. 在Cloudflare控制台中，导航到 **R2**
2. 点击 **创建存储桶**
3. 输入存储桶名称（如 `pdf-files`）
4. 点击 **创建存储桶**
5. 在Worker设置中，将此存储桶绑定为 `MY_BUCKET`

#### 4. KV命名空间配置

1. 在Cloudflare控制台中，导航到 **Workers & Pages** > **KV**
2. 点击 **创建命名空间**
3. 输入命名空间名称（如 `PDF_FILES`）
4. 点击 **创建**
5. 在Worker设置中，将此命名空间绑定为 `PDF_FILES`

### 域名配置

#### 1. 使用默认域名

部署完成后，您可以使用Cloudflare分配的默认域名访问项目：`[项目名称].pages.dev`

#### 2. 自定义域名

1. 在Cloudflare控制台中，导航到您的Pages项目
2. 点击 **自定义域** 标签页
3. 点击 **设置自定义域**
4. 输入您的自定义域名
5. 按照提示完成DNS配置
6. 等待DNS记录生效（通常需要几分钟到几小时）

## 🔧 Cloudflare Workers配置

### Workers设置

1. **脚本内容**：确保 `_worker.js` 文件的内容正确部署到Worker
2. **路由**：默认情况下，Worker会处理所有API请求
3. **兼容性标志**：确保启用了必要的兼容性标志

### R2存储桶配置

1. **权限**：确保Worker具有对R2存储桶的读写权限
2. **CORS**：在R2存储桶设置中配置适当的CORS规则

### KV命名空间配置

1. **权限**：确保Worker具有对KV命名空间的读写权限
2. **过期时间**：根据需要设置键值对的过期时间

### 环境变量配置

| 环境变量 | 类型 | 说明 |
|--------|------|------|
| `ACCESS_PASSWORD` | 文本 | 用于用户认证的密码 |
| `PDF_FILES` | KV命名空间绑定 | 存储文件元数据 |
| `MY_BUCKET` | R2存储桶绑定 | 存储PDF文件 |

## 📖 使用指南

### 首次登录

1. 访问您的PDF智库网站
2. 输入在 `ACCESS_PASSWORD` 环境变量中设置的密码
3. 点击 **解锁** 按钮
4. 登录成功后，您将看到PDF文件管理界面

### 文件上传

1. 在 **库** 标签页中，填写文件标题和标签
2. 点击 **选择 PDF 文件** 按钮，选择要上传的PDF文件
3. 点击 **开始上传** 按钮
4. 等待上传完成，您将看到成功提示

### 文件管理

#### 查看文件
- 在文件列表中，点击文件名可以在新窗口中预览PDF文件

#### 删除文件
- 点击文件右侧的 **删除** 按钮
- 在确认对话框中点击 **确定**
- 文件将被移至回收站

#### 批量操作
- 勾选多个文件的复选框
- 使用底部的批量操作栏执行批量删除

### 搜索功能

1. 在搜索框中输入关键词
2. 按Enter键或等待自动搜索
3. 搜索结果将实时显示

#### 标签搜索
- 点击文件标签可以搜索具有相同标签的文件
- 在搜索框中输入 `#标签名` 可以直接搜索标签

### 回收站使用

1. 点击 **回收站** 标签页
2. 查看已删除的文件
3. 点击 **恢复** 按钮可以恢复文件
4. 批量删除可以永久删除文件

## 🎯 功能说明

### 认证系统

- **基于密码**：使用设置的 `ACCESS_PASSWORD` 进行认证
- **本地存储**：登录状态存储在本地，使用 `localStorage`
- **安全保障**：API请求需要携带认证信息

### 文件管理

- **上传限制**：取决于Cloudflare R2的存储限制
- **文件大小**：取决于Cloudflare Workers的请求大小限制（默认100MB）
- **文件格式**：仅支持PDF文件

### 标签系统

- **标签格式**：支持逗号分隔的标签列表
- **标签搜索**：点击标签或使用 `#标签名` 格式搜索
- **标签管理**：在文件上传时添加标签

### 搜索功能

- **实时搜索**：输入时自动搜索
- **模糊匹配**：支持部分匹配
- **标签搜索**：支持按标签搜索

### PDF预览

- **基于PDF.js**：使用Mozilla的PDF.js库
- **高质量渲染**：支持清晰的PDF渲染
- **响应式**：适配不同屏幕尺寸
- **功能丰富**：支持缩放、滚动和页面导航

## ❓ 常见问题

### 部署问题

**Q: 部署后页面无法正常加载？**
A: 检查Cloudflare Pages的部署状态，确保部署成功。

**Q: API请求返回401错误？**
A: 检查 `ACCESS_PASSWORD` 环境变量是否正确设置，确保登录时使用的密码与环境变量中的密码一致。

**Q: 文件上传失败？**
A: 检查R2存储桶是否正确配置，确保Worker具有对R2存储桶的写入权限。

### 功能问题

**Q: 搜索功能不工作？**
A: 检查搜索框输入是否正确，确保标签搜索使用 `#标签名` 格式。

**Q: PDF预览空白？**
A: 检查PDF文件是否完整，网络连接是否正常，CDN资源是否可以访问。

**Q: 标签点击无响应？**
A: 检查浏览器控制台是否有JavaScript错误，确保 `searchByTag` 函数正确实现。

### 性能问题

**Q: 页面加载缓慢？**
A: 检查网络连接，Cloudflare Pages通常提供快速的加载速度。

**Q: 文件上传速度慢？**
A: 上传速度取决于您的网络连接和文件大小，大文件上传可能需要更长时间。

**Q: 大量文件时页面卡顿？**
A: 考虑使用分页加载或虚拟滚动来优化性能。

## ⚙️ 高级配置

### 自定义域名

1. 在Cloudflare控制台中，导航到您的Pages项目
2. 点击 **自定义域** 标签页
3. 输入您的自定义域名
4. 按照提示配置DNS记录
5. 等待DNS记录生效

### CDN缓存配置

1. 在Cloudflare控制台中，导航到您的域名
2. 点击 **缓存** 标签页
3. 配置缓存规则，建议为PDF文件设置适当的缓存时间

### 安全设置

1. **HTTPS**：确保启用了强制HTTPS
2. **WAF**：考虑启用Web应用防火墙
3. **访问控制**：可以配置IP访问限制

### 性能优化

1. **图片优化**：如果添加了缩略图，确保图片经过优化
2. **代码压缩**：压缩JavaScript和CSS文件
3. **资源加载**：优化资源加载顺序

## 🤝 贡献指南

### 开发规范

- 遵循现代JavaScript规范
- 使用语义化的HTML
- 保持CSS代码整洁
- 添加适当的注释

### 提交流程

1. Fork项目仓库
2. 创建功能分支
3. 提交更改
4. 推送到分支
5. 创建Pull Request

### 代码风格

- 使用2空格缩进
- 使用单引号
- 遵循ES6+语法
- 保持代码简洁明了

## 📄 许可证

本项目采用MIT许可证。详情请参阅LICENSE文件。

## 📞 支持

如果您在使用过程中遇到问题，可以：

1. 查看本README文件
2. 检查Cloudflare文档
3. 在GitHub仓库中提交Issue

---

**PDF智库** - 让PDF文件管理变得简单高效！ 🎉